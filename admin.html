<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Kibriya MediTonic — Admin Orders</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <style>body{font-family:system-ui,Segoe UI,Roboto,'Noto Sans',sans-serif;max-width:1000px;margin:20px auto;padding:10px} table{width:100%;border-collapse:collapse} th,td{padding:8px;border:1px solid #ddd} .btn{padding:6px 10px;border-radius:6px;border:0;cursor:pointer} .btn-assign{background:#0b67d0;color:#fff}</style>
</head>
<body>
  <h1>Kibriya MediTonic — Admin Orders</h1>
  <p>Hotline: 01839849549 | Address: Parbatipur, Dinajpur</p>
  <p><em>Note: This simple admin uses the Supabase anon key for demo only. For production, secure your API and use RLS policies.</em></p>
  <div id="orders"></div>

<script>
const SUPABASE_URL = "https://engpvhpzxkfkxldtziql.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuZ3B2aHB6eGtma3hsZHR6aXFsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NDA0MTQsImV4cCI6MjA4MDAxNjQxNH0.WTdUH8xGnz34cs6iivb-rM2A1GlyEQGN1qtIATVFQek";
const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_KEY);

async function loadOrders(){
  const resp = await supabase.from('orders').select('*').order('created_at',{ascending:false}).limit(100);
  if(resp.error){ document.getElementById('orders').innerText = 'Error: ' + resp.error.message; return; }
  const data = resp.data;
  if(!data || !data.length){ document.getElementById('orders').innerText = 'No orders yet.'; return; }
  const html = ['<table><thead><tr><th>ID</th><th>Name</th><th>Phone</th><th>Items</th><th>Pres</th><th>Delivery</th><th>Charge</th><th>Status</th><th>Actions</th></tr></thead><tbody>'];
  data.forEach(o=>{
    html.push('<tr>');
    html.push('<td>'+o.id+'</td>');
    html.push('<td>'+ (o.customer_name||'') +'</td>');
    html.push('<td>'+ (o.phone||'') +'</td>');
    html.push('<td><pre style="white-space:pre-wrap">'+ (o.items||'') +'</pre></td>');
    html.push('<td>' + (o.prescription_url ? '<a href="'+o.prescription_url+'" target="_blank">View</a>' : '') + '</td>');
    html.push('<td>'+ (o.delivery_type||'') +'</td>');
    html.push('<td>'+ (o.delivery_charge||'') +'</td>');
    html.push('<td id="status-'+o.id+'">'+ (o.status||'') +'</td>');
    html.push('<td><button class="btn btn-assign" onclick="updateStatus(\''+o.id+'\',\'verified\')">Verify</button> <button class="btn" onclick="updateStatus(\''+o.id+'\',\'out_for_delivery\')">Out for delivery</button> <button class="btn" onclick="updateStatus(\''+o.id+'\',\'delivered\')">Delivered</button></td>');
    html.push('</tr>');
  });
  html.push('</tbody></table>');
  document.getElementById('orders').innerHTML = html.join('');
}

async function updateStatus(id, status){
  const resp = await supabase.from('orders').update({ status }).eq('id', id).select();
  if(resp.error){ alert('Error:' + resp.error.message); return; }
  document.getElementById('status-'+id).innerText = status;
}

loadOrders();
</script>
</body>
</html>
